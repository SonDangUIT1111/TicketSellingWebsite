generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model User {
  id                Int      @id @default(autoincrement())
  name              String
  email             String   @unique
  phoneNumber       String?
  password          String
  cccdNumber        String
  diaChi            String?
  role              String?  @default("user")
  avatar            String?  @default("https://i0.wp.com/www.repol.copl.ulaval.ca/wp-content/uploads/2019/01/default-user-icon.jpg?ssl=1")
  isEmailVerified   Boolean  @default(false)
  createdAt         DateTime @default(now())
  loaiHinhKinhDoanh Int
  anhDaiDienToChuc  String?  @default("https://i0.wp.com/www.repol.copl.ulaval.ca/wp-content/uploads/2019/01/default-user-icon.jpg?ssl=1")
  hoTenOrganizer    String
  maSoThueCaNhan    String
  tenDoanhNghiep    String
  maSoDKKD          String
  noiCap            String
  ngayCap           String
  SuKiens           SuKien[]
  HoaDon            HoaDon[]
}

model SuKien {
  id            Int      @id @default(autoincrement())
  name          String
  moTa          String?
  diaChi        String?
  hinhAnhSuKien String?  @db.LongText
  ngayBatDau    DateTime
  ngayKetThuc   DateTime
  userId        Int
  ChuDeId       Int
  user          User     @relation(fields: [userId], references: [id])
  ChuDe         ChuDe    @relation(fields: [ChuDeId], references: [id])
  ves           Ve[]

  @@index([userId])
  @@index([ChuDeId])
}

model ChuDe {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  createdAt DateTime @default(now())
  SuKiens   SuKien[]
}

model Ve {
  id              Int        @id @default(autoincrement())
  name            String
  moTa            String?
  gia             Float
  mau             String
  soLuong         Int
  soLuongToiThieu Int
  soLuongToiDa    Int
  ngayBan         DateTime
  ngayKetThuc     DateTime
  SuKienId        Int
  suKien          SuKien     @relation(fields: [SuKienId], references: [id])
  HoaDon          HoaDon[]
  HoaDonVe        HoaDonVe[]

  @@index([SuKienId])
}

model HoaDon {
  id                  Int        @id @default(autoincrement())
  ngayDatHang         DateTime
  userId              Int
  phuongThucThanhToan String
  createdAt           DateTime   @default(now())
  veId                Int?
  user                User       @relation(fields: [userId], references: [id])
  HoaDonVe            HoaDonVe[]
  Ve                  Ve?        @relation(fields: [veId], references: [id])

  @@index([userId])
  @@index([veId])
}

model HoaDonVe {
  id       Int    @id @default(autoincrement())
  hoaDonId Int
  veId     Int
  soLuong  Int
  tongGia  Float
  hoaDon   HoaDon @relation(fields: [hoaDonId], references: [id])
  ve       Ve     @relation(fields: [veId], references: [id])

  @@index([hoaDonId, veId], map: "HoaDonVe_HoaDonVeId")
  @@index([veId])
}
